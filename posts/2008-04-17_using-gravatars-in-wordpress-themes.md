title: Wordpress 2.5: Прикручиваем Gravatar
link: http://paradigm.ru/using-gravatars-in-wordpress-themes
creator: admin
description:
post_id: 275
created: 2008/04/17 00:01:49
created_gmt: 2008/04/17 07:01:49
comment_status: open
post_name: using-gravatars-in-wordpress-themes
status: publish
post_type: post

# Wordpress 2.5: Прикручиваем Gravatar

Последние изменения в конфигурации Wordpress на этом сайте были связаны с устранением необходимости в некоторых второстепенных плагинах. В первую очередь это относилось к различным расширениям функциональности темы. Например, ради того, чтобы заменить URL стандартных RSS-фидов на линки Фидбёрнера или вставить в страницы код Google Analytics, вовсе не обязательно ставить специальный плагин.

Конечно, управление через административную панель более удобно, чем правка кода вручную, но каждый такой плагин увеличивает объем исполняемого PHP кода при любом обращении к сайту. Поэтому было принято стратегическое решение — _если плагин можно не ставить,_ обойдясь функциональностью стандартного API Wordpress, _такой плагин лучше не ставить_.

Последним из устраненных плагинов был Easy Gravatar, добавляющий к комментариям аватары с одноименного сервиса. В этой заметке расскажу, в двух словах, как добавить в тему для Wordpress 2.5 такие аватары самостоятельно.

![Wordpress - Комментарии с граватарами](/media/comments.png)

Я не случайно упомянул номер версии. До выхода последнего на сегодняшний день релиза, стандартных функций для работы с Gravatar не было. А само их появление совсем не удивительно, учитывая, что Wordpress и Gravatar принадлежат одному и тому же Automattic.

Принцип действия Gravatar очень прост. Для того, чтобы получить с их сервера юзерпик комментатора, необходимо разместить в коде страницы обычный элемент <img>, указав в нем стандартный URL с набором GET-параметров. В общем виде URL граватара выглядит так:

    http://www.gravatar.com/avatar.php?gravatar_id=...&rating=R
    &size=40&default=...&border=FF0000

Значение параметров:

  * `gravatar_id` — единственный параметр, являющийся обязательным. Это идентификатор пользователя в базе данных Gravatar, основанный на адресе электронной почты. Учитывая, что при комментировании, указание email как правило является обязательным, адрес становится доступным в ходе генерирования страницы. А для того, чтобы его не светить в открытом доступе, в списке параметров указывается не сам email, а его [MD5](http://ru.wikipedia.org/wiki/MD5)-хэш.
  * `rating` — [ESRB-рейтинг](http://ru.wikipedia.org/wiki/Entertainment_Software_Rating_Board), дань политкорректности. Значение этого параметра определит «рамки приличия» для аватаров, которые можно демонстрировать на страницах вашего сайта (возможные варианты — G/PG/R/X; регистр не имеет значения). Скажем, если указать G, никто из комментаторов теоретически не сможет <strike>раскрыть таким странным образом тему сисек</strike> использовать юзерпики нецензурного содержания. Но в полной мере полагаться на этот параметр не стоит, т.к. никакой модерации, на сколько мне известно, на Gravatar нет и пользователи сами выставляют своим аватарам рейтинг.
  * `border` — если этому параметру задать цветовой код в формате RGB (без решетки), аватары будут обрамлены однопиксельной рамкой соответствующего цвета. Неплохо, что эта возможность присутствует, но она опять же не особенно полезна, т.к. примерно того же эффекта можно добиться с помощью CSS.
  * `size` — а вот это уже более нужный параметр, хотя тоже необязательный для указания в URL. Он определяет размер стороны юзерпика в пикселях (картинки всегда квадратные, поэтому достаточно одной величины). Возможные значение — от 1 (что забавно), до 80. Если размер не указать вообще, он останется оригинальным. Т.е. тем, в котором пользователь загрузил свой аватар на сервер. В противном случае, юзерпик будет масштабирован. Кстати, для масштабирования графики Gravatar использует биквадратичный алгоритм, благодаря чему уменьшенные копии выглядят достаточно «гладко».
  * `default` — полный URL картинки, которая будет отображена вместо аватара, если пользователь отсутствует или рейтинг его аватара превышает указанное значение. Если параметр не задать, будет использован стандартный вариант с логотипом Gravatar.

Для упрощения взаимодействия с сервисом, в API Wordpress появилась функция `get_avatar()`, преобразующая набор своих параметров в сформированный элемент <img>.

Параметры следующие:

## Comments

**[Илья](#557 "2008/04/17 01:11:52"):** Пардон, а можно поподробнее про чтобы заменить URL стандартных RSS-фидов на линки Фидбёрнера или вставить в страницы код Google Analytics, вовсе не обязательно ставить специальный плагин Гугл по-партизански молчит об этом..

**[admin](#558 "2008/04/17 01:17:57"):** Илья: Мне казалось, это совсем тривиальная задача (потому и не стал про это подробнее писать), но раз есть потребность, расскажу подробнее в одном из ближайших постов.

**[Илья](#559 "2008/04/17 01:26:58"):** Ну, если эта задача решается правкой php-файлов темы, то да, это вполне тривиально. Но это можно было делать и в прошлой версии WP. Сейчас же, полагаю, речь идет о доп. настройках самого ядра? В dashboard такие настройки найти не удалось.

**[admin](#560 "2008/04/17 01:47:41"):** Илья: Нет, встроенной возможности для замены RSS и включения кода GA точно не появилось. И, как мне кажется, вряд ли предвидится. Разве что Google купит Automattic (:

**[DrakAngel](#1020 "2008/06/12 00:30:12"):** Я не понял, где все это прописывать-то?)

**[admin](#1022 "2008/06/12 10:26:05"):** DrakAngel: В коде используемой темы. Если конкретно, в том ее файле, который отвечает за отображение списка комментариев. Обычно такой файл называется comments.php.

**[Drakasmit](#1748 "2008/08/25 04:06:54"):** :) настроил спасибо за статью :) прикольная штука эти гаватары

**[eavasi](#34584 "2009/05/21 20:14:40"):** Вот уже два месяца, как обзавелся блогом, а об Граватаре узнал только сейчас. Век живи, век учись.

**[Titto](#36990 "2009/08/16 09:11:02"):** Интересный сервис, надо попробовать :)

