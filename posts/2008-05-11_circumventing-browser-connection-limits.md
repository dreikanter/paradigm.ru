title: Обход лимита одновременных соединений в браузерах
link: http://paradigm.ru/circumventing-browser-connection-limits
creator: admin
description: 
post_id: 321
created: 2008/05/11 03:15:26
created_gmt: 2008/05/11 00:15:26
comment_status: open
post_name: circumventing-browser-connection-limits
status: publish
post_type: post

# Обход лимита одновременных соединений в браузерах

Статья написана еще в декабре 2006 года, но, не смотря на это, показалась мне интересной и актуальной. Тем не менее, некоторые цифры в тексте могут отличаться от актуальных для настоящего времени значений.

**Автор:** Ryan Breen, [ajaxperformance.com](http://ajaxperformance.com/) **Оригинал:** «[Circumventing browser connection limits for fun and profit](http://b23.ru/pxk)» **Перевод:** Александр Мусаев, [paradigm.ru]()

Недавно на Digg появился [видеоролик с Metacafe](http://b23.ru/puf), где демонстрировался способ увеличения скорости открытия страниц в браузе. Рассмотрим подробнее то, как происходит управление сетевыми соединениями, чтобы понять причину такого эффекта.

В процессе принятия решений, разработчики программного обеспечения зачастую вынуждены руководствоваться «утилитарными» принципами. Перефразируя Джереми Бентама, таковым является подход, при котором наилучший результат достигается для наибольшего количества конечных пользователей (в оригинале, согласно классической формулировке Бентама, моральным является то, что «приносит наибольшее счастье наибольшему количеству людей,»  _прим. переводчика_). Потеря производетельности, которая отразится на работе определенной группы пользователей, может быть обоснована выйгрышем для более широкой группы.

Все распространенные сейчас браузеры изначально разрабатывались еще в то время, когда подавляющее большинство пользователей Сети работало через низкоскоростные dial-up подключения. Это было основной причиной необходимости ограничивать количество одновременных соединений. Постоянное чередование большого количества сетевых соединений может приводить к существенной потере скорости пересылки данных для каждого из них. Кроме того, веб-серверы и прокси в тот период так же не отличались высокой производительностью. Поэтому лимитирование пула соединений в браузере было дополнительно обосновано снижением нагрузки на сетевую инфраструктуру.

IE и Firefox по-умолчанию допускают 6 параллельных соединений по протоколу HTTP 1.1. При этом на каждых хост может приходиться не более 2 одновременных соединений. С HTTP 1.0 немного другая история, но мы не будем рассматривать его отдельно, т.к. преимущества постоянных соединений в сделали версию 1.1 значительно более предпочтительной.

Конечно, в настоящее время утилитарный способ принятия решений давно себя изжил. Большинство пользователей имеют доступ в сеть по широкополосным каналам, и пропускная способность с клиентской стороны уже перестала быть узким местом. Чаще всего основной причиной задержек при загрузки отдельных объектов становится процесс установки соединения и пересылка запросов. Увеличение количества одновременных соединений может сократить общее время обработки списка загружаемых объектов.

К сожалению, полагаться на то, что пользователи сами станут оптимизировать настройки браузеров, бессмысленно. Но для повышения производительности веб-разработчики могут прибегать к альтернативным решениям.

Большинство сайтов использует один единственный хост, что ограничивает количество соединений до двух. Распределение контента между несколькими хостами может стать эффективной стратегий для распараллеливания загрузки. Добиться этого довольно несложно, т.к. браузеры обращают внимание только на доменное имя, а не на IP. Поэтому для images1.yoursite.com и images2.yoursite.com будет выделено уже не 2, а 4 отдельных соединения. 

Для примера рассмотрим [веб-приложение](http://musicstore.ajaxperformance.com/), в котором генерируются страницы с большим количеством графики. По-умолчанию картинки загружаются с одного и того же хоста, и количество одновременных соединений ограничено двумя. Ниже приведена «каскадная» схема, иллюстрирующая последовательность загрузки файлов.

[![](/;-\)/2008/05/00two_conn_waterfall_small.png)](http://b23.ru/pui)

На графике видно, что для хоста musicstore.ajaxperformance.com открыто только два сетевых соединения  C0 и С2. Мы используем HTTP 1.1, поэтому необходимость каждый раз открывать новые соединения отсутствует. Тем не менее, большая часть времени уходит на обработку запросов, а не передачу данных (синяя часть полоски начинается от первого переданного байта запроса, а красная показывает передаваемый контент).

## Comments

**[Gluek](#732 "2008/05/11 14:39:53"):** Вот только как быть с кэшированием таких объектов? По идее надо всегда на один отдельный объект «выделять» свой CNAME, чтобы браузер его закэшировал и больше не запрашивал. Можно привязать к имени (например картинки, имя которых начинается с «a» — загружать с img1, с «b» — с img2) или использовать схему посложнее — с подсчетом хэшей (по имени файла или url).

**[admin](#733 "2008/05/11 15:47:16"):** Gluek: Согласен, динамический выбор CNAME от балды - может быть неэффективен. Но если привязываться только к именам картинок или хэшу может получиться так, что объекты распределятся по хостам неравномерно и какой-то из них все равно будет перегружен. Оптимальный вариант стоит подбирать относительно конкретных условий (когда и как генерируются ссылки на объекты). Можно распределять по первой букве, можно по дате добавления (unixtime % N) или, например, с помощью глобального циклического счетчика, который будет инкрементироваться при каждой новой обработанной ссылке (i++ % N).

**[Михаил Наумов](#987 "2008/06/06 16:26:50"):** Интересная статья, спасибо, буду знать.

**[sunnybear](#3580 "2008/10/19 10:03:31"):** Прикольно, еревод этой же статьи появился и на webo.in, однако, на 8 дней позже :) http://webo.in/articles/habrahabr/39-out-of-connections-limits/

**[sunnybear](#3581 "2008/10/19 10:12:29"):** Прикольно, перевод этой же статьи появился и на webo.in, однако, на 8 дней позже :) http://webo.in/articles/habrahabr/39-out-of-connections-limits/

**[Zugr](#61268 "2011/12/07 10:17:58"):** Очень даже полезная статья.

